---
import { getLangFromUrl } from "@/i18n/utils"
import type {
	Langs,
	Product,
	ProductFromImport,
	ProductMDXContent,
	ProductMDXGlobResult,
} from "@/types"
import List from "@/components/core/Products/List.astro"

const lang = getLangFromUrl(Astro.url) as Langs

const productFiles = (await import.meta.glob<ProductMDXContent>("@/content/products/**/*.json", {
	eager: true,
})) as ProductMDXGlobResult

const productList: ProductFromImport[] = Object.values(productFiles)
	.filter(
		(product): product is ProductMDXContent & { default: { lang: Langs } } =>
			product.default.lang === lang
	)
	.map(
		({
			default: {
				name,
				title,
				category,
				thumbnail,
				gallery,
				description,
				price,
				paymentMethods,
				lang,
			},
			Content,
		}) => ({
			name,
			title,
			category,
			thumbnail,
			gallery,
			description,
			price,
			paymentMethods,
			lang,
			Content,
		})
	)
---

<section class="flex items-center justify-center px-5 py-14 md:pb-40">
	<div class="container">
		<List products={productList} />
	</div>
</section>
